/*! Entersoft Application Server WEB API - v1.5.3 - 2015-11-29
* Copyright (c) 2015 Entersoft SA; Licensed Apache-2.0 */
!function(){"use strict";function a(a,b){return-1!==a.indexOf(b,a.length-b.length)}function b(a,b){return 0===a.toLowerCase().indexOf(b.toLowerCase())}var c=angular.module("es.Services.Web",["ngStorage","ngSanitize","ngFileUpload"]);c.constant("ESWEBAPI_URL",{__LOGIN__:"api/Login",__PUBLICQUERY__:"api/rpc/PublicQuery/",__MULTI_PULIC_QUERY__:"api/rpc/MultiPublicQuery/",__PUBLICQUERY_INFO__:"api/rpc/PublicQueryInfo/",__USERSITES__:"api/Login/Usersites",__STANDARD_ZOOM__:"api/rpc/FetchStdZoom/",__MULTI_STANDARD_ZOOM__:"api/rpc/MultiFetchStdZoom/",__SCROLLERROOTTABLE__:"api/rpc/SimpleScrollerRootTable/",__SCROLLER__:"api/rpc/SimpleScroller/",__ENTITYACTION__:"api/Entity/",__ENTITYBYGIDACTION__:"api/EntityByGID/",__ELASTICSEARCH__:"api/esearch/",__SERVER_CAPABILITIES__:"api/Login/ServerCapabilities/",__REGISTER_EXCEPTION__:"api/rpc/registerException/",__FETCH_COMPANY_PARAM__:"api/rpc/FetchCompanyParam/",__FETCH_COMPANY_PARAMS__:"api/rpc/FetchCompanyParams/",__SCROLLER_COMMAND__:"api/rpc/ScrollerCommand/",__FORM_COMMAND__:"api/rpc/FormCommand/",__FETCH_SESSION_INFO__:"api/rpc/FetchSessionInfo/",__FETCH_ODS_TABLE_INFO__:"api/rpc/FetchOdsTableInfo/",__FETCH_ODS_COLUMN_INFO__:"api/rpc/FetchOdsColumnInfo/",__FETCH_ODS_RELATION_INFO__:"api/rpc/FetchOdsRelationInfo/",__FETCH_ODS_DETAIL_RELATIONS_INFO__:"api/rpc/FetchOdsDetailRelationsInfo/",__FETCH_ODS_MASTER_RELATIONS_INFO__:"api/rpc/FetchOdsMasterRelationsInfo/",__FI_IMPORTDOCUMENT___:"api/rpc/FIImportDocument/",__FETCH_ENTITY__:"api/rpc/fetchEntity/",__FETCH_WEB_EAS_ASSET__:"api/asset/",__FETCH_ES00DOCUMENT_BY_GID__:"api/ES00Documents/InfoByGID/",__FETCH_ES00DOCUMENT_BY_CODE__:"api/ES00Documents/InfoByCode/",__FETCH_ES00DOCUMENT_BY_ENTITYGID__:"api/ES00Documents/InfoByEntityGid/",__FETCH_ES00DOCUMENT_BLOBDATA_BY_GID__:"api/ES00Documents/BlobDataByGID/",__FETCH_ES00DOCUMENT_MIME_TYPES__:"api/ES00Documents/ESMimeTypes/",__DELETE_ES00DOCUMENT__:"api/ES00Documents/DeleteES00Document/",__ADD_OR_UPDATE_ES00DOCUMENT_BLOBDATA__:"api/ES00Documents/AddOrUpdateES00DocumentBlobData/"}),c.value("__WEBAPI_RT__",{url:""}),c.provider("esWebApi",function(){var c="",d="",e="",f={host:"",allowUnsecureConnection:!1,subscriptionId:"",subscriptionPassword:""};return{getSettings:function(){return f},getServerUrl:function(){return c},setSettings:function(g){var h="https://",i="http://";if(f=g,!f.host)throw"host for Entersoft WEB API Server is not specified";if(f.host=f.host.trim(),b(f.host,h)?f.host=f.host.slice(h.length).trim():b(f.host,i)&&(f.host=f.host.slice(i.length).trim()),""==f.host)throw"host for Entersoft WEB API Server is not specified";return a(f.host,"/")||(f.host+="/"),d=i+f.host,e=h+f.host,c=f.allowUnsecureConnection?d:e,this},$get:["$http","$log","$q","$timeout","$rootScope","ESWEBAPI_URL","esGlobals","esMessaging","Upload","esCache",function(a,b,g,h,i,j,k,l,m,n){function o(a,d){if(a){var e=angular.copy(a);try{e.__SubscriptionID=f.subscriptionId,e.__ServerUrl=c,e.__EDate=new Date,$.ajax({type:"POST",url:c.concat(j.__REGISTER_EXCEPTION__),contentType:"application/json",headers:{Authorization:k.getWebApiToken()},data:JSON.stringify({exceptionData:e,exceptionStore:d},null,"	")});var g=k.getGA();g&&g.registerException(e)}catch(h){b.warn("Error logging failed"),b.error(h)}}}function p(){var b=g.defer(),d=n.getItem("ES_MIME_TYPES");if(d)return h(function(){b.resolve(d)}),b.promise;var e=c.concat(j.__FETCH_ES00DOCUMENT_MIME_TYPES__),f=k.trackTimer("ES00DOCUMENT_MIME","FETCH","");f.startTime();var i={method:"GET",headers:{Authorization:k.getWebApiToken()},url:e},l=a(i);return u(l,f).then(function(a){n.setItem("ES_MIME_TYPES",a.data),b.resolve(a.data)},function(){b.reject(arguments)}),b.promise}function q(b){if(!b||!b.ScrollerID||!b.CommandID)throw"ScrollerID and CommandID properties must be defined";var c=j.__SCROLLER_COMMAND__,d=k.trackTimer("SCR","COMMAND",b.ScrollerID.concat("/",b.CommandID));d.startTime();var e=a({method:"post",headers:{Authorization:k.getWebApiToken()},url:c,data:b});return e.then(function(){d.endTime().send()}),e}function r(b,d){var e=c+j[b]+d,f=g.defer(),i=n.getItem(e);if(i)return h(function(){f.resolve(i)}),f.promise;var l=a({method:"get",headers:{Authorization:k.getWebApiToken()},url:e});return u(l).then(function(a){n.setItem(e,a),f.resolve(a)},function(){f.reject(arguments)}),f.promise}function s(b){if(!b||!b.EntityID||!b.CommandID)throw"EntityID and CommandID properties must be defined";var d=c+j.__FORM_COMMAND__,e=k.trackTimer("FORM","COMMAND",b.EntityID.concat("/",b.CommandID));e.startTime();var f=a({method:"post",headers:{Authorization:k.getWebApiToken()},url:d,data:b});return u(f,e)}function t(b,d,e,f){d=d?d.trim():"",e=e?e.trim():"";var g=c.concat(b,d,"/",e),h=k.trackTimer("SCR","FETCH",d.concat("/",e));h.startTime();var i=a({method:"GET",headers:{Authorization:k.getWebApiToken()},url:g,params:f});return u(i,h)}function u(a,b){return b&&a.then(function(){b.endTime().send()}),a.error(function(a,b){l.publish("ES_HTTP_CORE_ERR",a,b)}),a}return{getServerUrl:function(){return c},openSession:function(d){var e=k.trackTimer("AUTH","LOGIN","");e.startTime();var g=a({method:"post",url:c+j.__LOGIN__,data:{SubscriptionID:f.subscriptionId,SubscriptionPassword:f.subscriptionPassword,Model:d}}).success(function(a){k.sessionOpened(a,d),e.endTime().send()}).error(function(a,c,d,e){k.sessionClosed(),a?b.error(a):console.log("Generic Http error")});return u(g)},logout:function(){k.sessionClosed(),b.info("LOGOUT User")},fetchCompanyParam:function(b){if(!b)return void 0;var d=c.concat(j.__FETCH_COMPANY_PARAM__,b.replace(" ","")),e=a({method:"get",headers:{Authorization:k.getWebApiToken()},url:d});return u(e)},fetchCompanyParams:function(b){var d;d=b?angular.isArray(b)?c+j.__FETCH_COMPANY_PARAMS__+b.join("/").replace(/ /g,""):c+j.__FETCH_COMPANY_PARAMS__+b.replace(/,/g,"/").replace(/ /g,""):c+j.__FETCH_COMPANY_PARAMS__;var e=a({method:"get",headers:{Authorization:k.getWebApiToken()},url:d});return u(e)},registerException:o,fetchOdsTableInfo:function(a){return a=a?a.trim():"",r("__FETCH_ODS_TABLE_INFO__",a)},fetchOdsColumnInfo:function(a,b){a=a?a.trim():"",b=b?b.trim():"";var c="";if(b)c=a+"/"+b;else{var d=a.split(".");c=2==d.length?d[0]+"/"+d[1]:a}return r("__FETCH_ODS_COLUMN_INFO__",c)},fetchOdsRelationInfo:function(a){return a=a?a.trim():"",r("__FETCH_ODS_RELATION_INFO__",a)},fetchOdsMasterRelationsInfo:function(a,b){return a=a?a.trim():"",b=b?b.trim():"",r("__FETCH_ODS_MASTER_RELATIONS_INFO__",a+"/"+b)},fetchOdsDetailRelationsInfo:function(a,b){return a=a?a.trim():"",b=b?b.trim():"",r("__FETCH_ODS_DETAIL_RELATIONS_INFO__",a+"/"+b)},fetchServerCapabilities:function(){var b=g.defer();return a.get(d+j.__SERVER_CAPABILITIES__).success(function(a){b.resolve(a)}).error(function(){a.get(e+j.__SERVER_CAPABILITIES__).success(function(a){b.resolve(a)}).error(function(a,c,d,e){b.reject([a,c,d,e])})}),b.promise},fetchScroller:function(a,b,c){return t(j.__SCROLLER__,a,b,c)},fetchSimpleScrollerRootTable:function(a,b,c){return t(j.__SCROLLERROOTTABLE__,a,b,c)},fetchUserSites:function(b){var d=a({method:"post",url:c+j.__USERSITES__,data:{SubscriptionID:f.subscriptionId,SubscriptionPassword:f.subscriptionPassword,Model:b}});return u(d)},fetchSessionInfo:function(){var b=a({method:"get",headers:{Authorization:k.getWebApiToken()},url:c+j.__FETCH_SESSION_INFO__});return u(b)},executeNewEntityAction:function(b,d,e){var f=c.concat(j.__ENTITYACTION__,b,"/",d),g=k.trackTimer("ACTION","NEW_ENTITY",b.concat("/",d));g.startTime();var h=a({method:"post",headers:{Authorization:k.getWebApiToken()},url:f,data:e});return u(h,g)},executeEntityActionByCode:function(b,d,e,f){var g=c.concat(j.__ENTITYACTION__,b,"/",d,"/",e),h=k.trackTimer("ACTION","ENTITY_CODE",b.concat("/",e));h.startTime();var i=a({method:"post",headers:{Authorization:k.getWebApiToken()},url:g,data:f});return u(i,h)},executeEntityActionByGID:function(b,d,e,f){var g=c.concat(j.__ENTITYBYGIDACTION__,b,"/",d,"/",e),h=k.trackTimer("ACTION","ENTITY_GID",b.concat("/",e));h.startTime();var i=a({method:"post",headers:{Authorization:k.getWebApiToken()},url:g,data:f});return u(i,h)},executeFormCommand:function(a){return s(a)},executeFormCommandDS:function(a,b,c,d){var e={EntityID:a,CommandID:b,CommandParams:c};return d&&(e.EntityDataset=d),s(e)},executeScrollerCommandSRV:function(a,b,c,d,e){var f={ScrollerID:a+"/"+b,CommandID:c,ScrollerParams:d,CommandParams:e};return q(f)},executeScrollerCommandDS:function(a,b,c,d,e){var f={ScrollerID:a+"/"+b,CommandID:c,ScrollerDataset:d,CommandParams:e};return q(f)},fetchPublicQueryInfo:function(b,d,e){var f=c.concat(j.__PUBLICQUERY_INFO__,b,"/",d),i=g.defer();if(e){var l=n.getItem(f);if(l)return h(function(){i.resolve(l)}),i.promise}var m=k.trackTimer("PQ","INFO",b.concat("/",d));m.startTime();var o=a({method:"get",headers:{Authorization:k.getWebApiToken()},url:f});return u(o,m).then(function(a){e&&n.setItem(f,a),i.resolve(a)},function(){i.reject(arguments)}),i.promise},fetchStdZoom:function(b,d,e){b=b?b.trim():"",e=!d&&e;var f=g.defer();if(e){var i=n.getItem("ESZOOM_"+b);if(i)return h(function(){f.resolve(i)}),f.promise}var l=c.concat(j.__STANDARD_ZOOM__,b),m=k.trackTimer("ZOOM","FETCH",b);m.startTime();var o=a({method:"get",headers:{Authorization:k.getWebApiToken(),"X-ESPQOptions":JSON.stringify(d)},url:l}),p=u(o,m);return p.then(function(a){e&&n.setItem("ESZOOM_"+b,a),f.resolve(a)},function(){f.reject(arguments)}),f.promise},fetchMultiStdZoom:function(b){var d=g.defer(),e=[];b=b||[];var f=_.filter(b,function(a){return a.UseCache&&n.getItem("ESZOOM_"+a.ZoomID)?!1:!0});if(0==f.length)return h(function(){var a;for(a=0;a<b.length;a++)e.push(n.getItem("ESZOOM_"+b[a].ZoomID));d.resolve(e)}),d.promise;var i=c.concat(j.__MULTI_STANDARD_ZOOM__),l=k.trackTimer("ZOOM","MULTI_FETCH","");l.startTime();var m=a({method:"POST",headers:{Authorization:k.getWebApiToken()},data:f,url:i}),o=u(m,l);return o.then(function(a){var c=0;_.each(b,function(b){if(b.UseCache&&n.getItem("ESZOOM_"+b.ZoomID))e.push(n.getItem("ESZOOM_"+b.ZoomID));else{var d=a[c];c+=1,b.UseCache&&n.setItem("ESZOOM_"+b.ZoomID,d),e.push(d)}}),d.resolve(e)},function(){d.reject(arguments)}),d.promise},fetchPublicQuery:function(b,d,e,f,g){var h;b instanceof k.ESPublicQueryDef?(h=(b.GroupID||"").trim(),d=(b.FilterID||"").trim(),e=b.PQOptions,f=b.Params):(h=b?b.trim():"",d=d?d.trim():"");var i=c.concat(j.__PUBLICQUERY__,h,"/",d),l=k.trackTimer("PQ","FETCH",h.concat("/",d));l.startTime();var m={headers:{Authorization:k.getWebApiToken()},url:i,params:f};e&&(m.headers["X-ESPQOptions"]=JSON.stringify(e)),m.method=g||"GET","GET"!==m.method&&(delete m.params,m.data=f);var n=a(m);return u(n,l)},multiPublicQuery:function(b){var d=c.concat(j.__MULTI_PULIC_QUERY__),e=k.trackTimer("MULTI-PQ","FETCH","");e.startTime();var f={headers:{Authorization:k.getWebApiToken()},url:d,method:"POST"};f.data=b;var g=a(f);return u(g,e)},fetchEASWebAsset:function(b,d){var e={base64:!1};d?(e.base64=!!d.base64,e.responseType=d.responseType,e.Accept=d.Accept):e.responseType="arraybuffer";var f=c.concat(j.__FETCH_WEB_EAS_ASSET__,b),g=k.trackTimer("EAS_ASSET","FETCH",b);g.startTime();var h={method:"GET",headers:{Authorization:k.getWebApiToken()},url:f,params:{base64:e.base64}};h.headers.Accept=e.Accept,e.responseType&&(h.responseType=e.responseType);var i=a(h);return u(i,g)},fetchEntity:function(b,d){if(!b||!d)throw"invliad parameters";var e=c.concat(j.__FETCH_ENTITY__,"/",b,"/",d),f=k.trackTimer("FETCH_ENTITY",b,d);f.startTime();var g=a({method:"get",headers:{Authorization:k.getWebApiToken()},url:e});return u(g,f)},fiImportDocument:function(b){if(!b)throw"xmldocstr is not a valid string";var d=c.concat(j.__FI_IMPORTDOCUMENT___),e=k.trackTimer("ESGENERAL","FIMPORTDOCUMENT");e.startTime();var f=a({method:"post",headers:{Authorization:k.getWebApiToken()},url:d,data:b});return u(f,e)},fetchES00DocumentBlobDataByGID:function(b){var d=c.concat(j.__FETCH_ES00DOCUMENT_BLOBDATA_BY_GID__,b),e=k.trackTimer("ES00DOCUMENT_BLOBDATA","FETCH",b);e.startTime();var f={method:"GET",headers:{Authorization:k.getWebApiToken(),Accept:void 0},url:d,params:{base64:!1},responseType:"arraybuffer"},g=a(f);return u(g,e)},getMimeTypes:p,fetchES00DocumentByGID:function(b){b=b?b.trim():"";var d=c.concat(j.__FETCH_ES00DOCUMENT_BY_GID__,b),e=k.trackTimer("ES00DOCUMENT","FETCH",b);e.startTime();var f=a({method:"get",headers:{Authorization:k.getWebApiToken()},url:d});return u(f,e)},fetchES00DocumentByCode:function(b){b=b?b.trim():"";var d=c.concat(j.__FETCH_ES00DOCUMENT_BY_CODE__,b),e=k.trackTimer("ES00DOCUMENT","FETCH",b);e.startTime();var f=a({method:"get",headers:{Authorization:k.getWebApiToken()},url:d});return u(f,e)},fetchES00DocumentsByEntityGID:function(b){b=b?b.trim():"";var d=c.concat(j.__FETCH_ES00DOCUMENT_BY_ENTITYGID__,b),e=k.trackTimer("ES00DOCUMENT_S","FETCH",b);e.startTime();var f=a({method:"get",headers:{Authorization:k.getWebApiToken()},url:d});return u(f,e)},deleteES00Document:function(b){if(b=b||{},!(b.TableID&&b.TableName&&b.GID&&b.fGID))throw"Invalid parameter. One or more of the properties TableID, TableName, fGID and GID are not specified";var d=c.concat(j.__DELETE_ES00DOCUMENT__),e=k.trackTimer("ES00DOCUMENT_S","DELETE",b.GID);e.startTime();var f=a({method:"post",headers:{Authorization:k.getWebApiToken()},url:d,data:b});return u(f,e)},addOrUpdateES00Document:function(a,b,d,e,f){return b.upload=m.upload({url:c.concat(j.__ADD_OR_UPDATE_ES00DOCUMENT_BLOBDATA__),method:"POST",headers:{Authorization:k.getWebApiToken()},fields:{esdoc:JSON.stringify(a)},file:b}),b.upload.then(function(a){h(function(){b.result=a.data,d(b)})},e),b.upload.progress(f),b.upload},eSearch:function(b,d,e){var f=c.concat(j.__ELASTICSEARCH__,b),g=a({method:d,headers:{Authorization:k.getWebApiToken()},url:f,data:e}).success(function(a){var c=k.getGA();c&&c.registerEventTrack({category:"ELASTIC_SEARCH",action:"SEARCH",label:b})}).error(function(a){try{o(a)}catch(b){}});return u(g)}}}]}}),c.factory("esElasticSearch",["esWebApi",function(a){return{searchIndex:function(b,c){var d=b+"/_search";return a.eSearch(d,"post",c)},searchIndexAndDocument:function(b,c,d){var e=b+"/"+c+"/_search";return a.eSearch(e,"post",d)},searchFree:a.eSearch}}])}(),function(){"use strict";var a=angular.module("es.Services.Analytics",[]);a.provider("es.Services.GA",function(){var a={gaKey:void 0,pageTracking:{autoTrackFirstPage:!0,autoTrackVirtualPages:!0,trackRelativePath:!1,autoBasePath:!1,basePath:""},developerMode:!1};return{setGAKey:function(a){gaKey=a},settings:a,virtualPageviews:function(a){this.settings.pageTracking.autoTrackVirtualPages=a},firstPageview:function(a){this.settings.pageTracking.autoTrackFirstPage=a},withBase:function(a){this.settings.pageTracking.basePath=a?angular.element("base").attr("href").slice(0,-1):""},withAutoBase:function(a){this.settings.pageTracking.autoBasePath=a},developerMode:function(a){this.settings.developerMode=a},start:function(b,c){window.ga&&b&&""!=b&&(a.gaKey=b,ga("create",b,c))},$get:["$window",function(b){return{settings:a,registerPageTrack:function(a){b.ga&&b.ga("send","pageview",a)},registerException:function(a){b.ga&&a&&b.ga("send","exception",{exDescription:JSON.stringify(a),exFatal:!1})},registerTiming:function(a){if(b.ga){if(!(a&&a.timingCategory&&a.timingVar&&a.timingValue))return;if(a.timingValue){var c=parseInt(a.timingValue,10);if(a.timingValue=isNaN(c)?0:c,0==a.timingValue)return}b.ga("send","timing",a)}},registerEventTrack:function(a){if(b.ga){if(!a||!a.category)return;if(a.value){var c=parseInt(a.value,10);a.value=isNaN(c)?0:c}for(var d={eventCategory:a.category||null,eventAction:a.action||null,eventLabel:a.label||null,eventValue:a.value||null,nonInteraction:a.noninteraction||null},e=1;20>=e;e++)a["dimension"+e.toString()]&&(d["dimension"+e.toString()]=a["dimension"+e.toString()]),a["metric"+e.toString()]&&(d["metric"+e.toString()]=a["metric"+e.toString()]);b.ga("send","event",d)}}}}]}}),a.run(["$rootScope","$window","es.Services.GA","$injector",function(a,b,c,d){c.settings.pageTracking.autoTrackFirstPage&&d.invoke(["$location",function(a){var e=!0;if(d.has("$route")){var f=d.get("$route");for(var g in f.routes){e=!1;break}}else if(d.has("$state")){var h=d.get("$state");for(var i in h.get()){e=!1;break}}if(e)if(c.settings.pageTracking.autoBasePath&&(c.settings.pageTracking.basePath=b.location.pathname),c.settings.trackRelativePath){var j=c.settings.pageTracking.basePath+a.url();c.registerPageTrack(j,a)}else c.registerPageTrack(a.absUrl(),a)}]),c.settings.pageTracking.autoTrackVirtualPages&&d.invoke(["$location",function(e){c.settings.pageTracking.autoBasePath&&(c.settings.pageTracking.basePath=b.location.pathname+"#"),d.has("$route")&&a.$on("$routeChangeSuccess",function(a,b){if(!b||!(b.$$route||b).redirectTo){var d=c.settings.pageTracking.basePath+e.url();c.registerPageTrack(d,e)}}),d.has("$state")&&a.$on("$stateChangeSuccess",function(a,b){var d=c.settings.pageTracking.basePath+e.url();c.registerPageTrack(d,e)})}]),c.settings.developerMode&&angular.forEach(c,function(a,b){"function"==typeof a&&(c[b]=function(){})})}]),a.directive("esAnalyticsOn",["$document","es.Services.GA",function(a,b){function c(a){return a.tagName.toLowerCase()+":"+(a.type||"")=="a:"}function d(a){return["button:","button:button","button:submit","input:button","input:submit"].indexOf(a.tagName.toLowerCase()+":"+(a.type||""))>=0}function e(a){return d(a)||c(a),"click"}function f(b){if(d(b))return"Command";if(c(b)){if(!b.href)return"Navigate";var e=b.href,f=/\.(mov|jpg|png|rar|avi|zip|exe|pdf|doc*|xls*|ppt*|mp*)$/i;if(e.match(/^https?\:/i)){var g=e.match(f);return e.match(a[0].domain)?g?"Internal Download":"Internal Link":g?"External Download":"External Link"}return e.match(/^mailto\:/i)?"Mail To":e.match(f)?"Download":"Navigate"}return b.id||b.name||b.tagName}function g(a){return d(a)?a.tagName.toLowerCase()+":"+(a.type||""):c(a)?a.href?a.href:a.innerText||a.value:a.id||a.name||a.tagName}function h(a){return d(a)||c(a)?a.innerText||a.value:a.id||a.name||a.tagName}function i(a){return"esAnalytics"===a.substr(0,11)&&-1===["On","If","Properties","EventType"].indexOf(a.substr(11))}function j(a){var b=a.slice(11);return"undefined"!=typeof b&&null!==b&&b.length>0?b.substring(0,1).toLowerCase()+b.substring(1):b}return{restrict:"A",link:function(c,d,k){var l=k.esAnalyticsOn||e(d[0]),m={};angular.forEach(k.$attr,function(a,b){i(b)&&(m[j(b)]=k[b],k.$observe(b,function(a){m[j(b)]=a}))}),m.category=m.category||f(d[0],a),m.action=m.action||g(d[0],a),m.label=m.label||h(d[0],a),angular.element(d[0]).bind(l,function(a){(!k.esAnalyticsIf||c.$eval(k.esAnalyticsIf))&&(k.esAnalyticsProperties&&angular.extend(m,c.$eval(k.esAnalyticsProperties)),b.registerEventTrack(m))})}}}])}(),function(a){"use strict";a.module("es.services.Web.Environment",[]).provider("Environment",[function(){function a(){var a=document.location.href.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);return a&&a[1]}var b={dev:[],prod:[],staging:[]},c="dev",d="/KB/app/images",e="/KB/app/templates";return{setStage:function(a){c=a},getStage:function(){return c},setAssetsPath:function(a){d=a},setTemplatesPath:function(a){e=a},addDevelopmentDomains:function(a){return b.dev=a,this},addProductionDomains:function(a){return b.prod=a,this},addStagingDomains:function(a){return b.staging=a,this},setStageFromDomain:function(){var d;for(var e in b)if(d=a(),b[e].indexOf(d)>=0){c=e;break}},$get:function(){return{stage:c,assetsPath:d,templatesPath:e,isDev:function(){return"dev"===c},isProduction:function(){return"prod"===c},isStaging:function(){return"staging"===c},getAssetsPath:function(){return d},getTemplatesPath:function(){return e}}}}}])}(window.angular),function(){"use strict";var a=angular.module("underscore",[]);a.factory("_",function(){return window._});var b="1.5.3",c=_.map(b.split("."),function(a){return parseInt(a)}),d={Major:c[0],Minor:c[1],Patch:c[2]},e=angular.module("es.Services.Web");e.provider("esCache",function(){var a=null,b={};return b.maxSize=-1,b.storage=null,{setMaxSize:function(a){angular.isNumber(a)?b.maxSize=a:b.maxSize=-1},getMaxSize:function(){return b.maxSize},getStorageSettings:function(){return b.storage},setStorageSettings:function(a){b&&(b.storage=a)},$get:function(){if("undefined"==typeof Cache)throw"You must include jscache.js";return window.Cache=Cache,a=new Cache(b.maxSize,!1,b.storage),{getItem:function(b){return a.getItem(b)},setItem:function(b,c,d){a.setItem(b,c,d)},removeItem:function(b){a.removeItem(b)},removeWhere:function(b){a.removeWhere(function(a,c){return b(a,c)})},size:function(){return a.size()},clear:function(){a.clear()},stats:function(){return a.getStats()}}}}}),e.factory("esMessaging",function(){function a(){if(!arguments||arguments.Length<1)throw"Publishing events requires at least one argument for topic id";var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d[a]&&angular.forEach(d[a],function(c){try{c.apply(null,b)}catch(d){console.log("Error in messaging handler for topic ",a)}})}function b(a,b){return d[a]||(d[a]=[]),d[a].push(b),[a,b]}function c(a){var b=a[0];d[b]&&angular.forEach(d[b],function(c){this==a[1]&&d[b].splice(c,1)})}var d={},e={publish:a,subscribe:b,unsubscribe:c};return e}),e.factory("esGlobals",["$sessionStorage","$log","esMessaging","esCache","$injector",function(a,b,c,e,f){function g(a,b,c,d,e){this.CtxID=a,this.GroupID=b,this.FilterID=c,this.PQOptions=d,this.Params=e}function h(a,b,c){this.ZoomID=a,this.PQOptions=b,this.UseCache=!!c}function i(a,b,c){this.Page=a,this.PageSize=b,this.WithCount=c}function j(){if(!f)return void 0;try{return f.get("es.Services.GA")}catch(a){return void 0}}function k(){if(!p.connectionModel){var d=a,e=null;if("undefined"!=typeof d.__esrequest_sesssion&&null!==d.__esrequest_sesssion){e=d.__esrequest_sesssion,p.connectionModel=e,c.publish("AUTH_CHANGED",p,n(e));var f=j();angular.isDefined(f)&&f.registerEventTrack({category:"AUTH",action:"RELOGIN",label:p.connectionModel.GID}),b.info("RELOGIN User ",p.connectionModel.Name)}else c.publish("AUTH_CHANGED",null,n(null)),b.info("NO RELOGIN from stored state")}return p.connectionModel}function l(b){var d=null;if(p.connectionModel&&(d=p.connectionModel.GID),p.connectionModel=b,b)a.__esrequest_sesssion=b;else{delete a.__esrequest_sesssion;var e=j();angular.isDefined(e)&&e.registerEventTrack({category:"AUTH",action:"LOGOUT",label:d})}c.publish("AUTH_CHANGED",p,n(b))}function m(a,b){if(!a)switch(b){case 401:return"Please Login first";case 403:return"You are not authorized. Please Login and try again";case 500:default:return"General Error. Please check your network and internet access"}if(a instanceof ArrayBuffer)try{a=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(a)))}catch(c){}var d="";if(a.UserMessage)return d=a.UserMessage,a.MessageID&&(d=d+" ("+a.MessageID+")"),d;if(a.Messages){if(angular.isArray(a.Messages)){var e=0;d=_.reduce(a.Messages,function(a,b){return a+"\r\n["+ ++e+"] "+b},"")}else d=a.Messages;return d?d:"General Error. Please check your network and internet access"}return"General Error. Please check your network and internet access"}function n(a){return a?"Bearer "+a.WebApiToken:""}function o(a,b,c){return this.category=a,this.variable=b,this.label=c?c:void 0,this.startTime,this.endTime,this}var p={hostUrl:"",connectionModel:null,getWebApiToken:function(){var a=n(k());return a},setModel:l,getModel:k};return o.prototype.startTime=function(){return this.startTime=(new Date).getTime(),this},o.prototype.endTime=function(){return this.endTime=(new Date).getTime(),this},o.prototype.send=function(){var a=this.endTime-this.startTime,b=j();return b?(b.registerTiming({timingCategory:this.category,timingVar:this.variable,timingValue:a,timingLabel:this.label}),this):void 0},{getVersion:function(){return d},getMimeTypeForExt:function(a,b){if(!b)return"";var c=b.split("."),d=c[c.length-1].toLowerCase();if(!d)return"";var e=_.find(a,function(a){return-1!=a.extension.indexOf(d)});return e?e.mime:""},getExtensionsForMimeType:function(a,b){if(!b)return[];b=b.toLowerCase();var c=_.find(mimelist,function(a){return a.mime==b});return c?c.extension:[]},getGA:j,getWebApiToken:function(){return p.getWebApiToken()},getClientSession:function(){return p},getUserMessage:m,ESPublicQueryDef:g,ESMultiZoomDef:h,ESPQOptions:i,sessionClosed:function(){p.setModel(null);try{e.clear()}catch(a){}},trackTimer:function(a,b,c){return new o(a,b,c)},sessionOpened:function(a,c){try{try{e.clear()}catch(d){}a.Model.LangID=a.Model.LangID||c.LangID,a.Model.LangID=a.Model.LangID||"el-GR",a.Model.BranchID=a.Model.BranchID||c.BranchID||"-",p.setModel(a.Model);var f=j();angular.isDefined(f)&&f.registerEventTrack({category:"AUTH",action:"LOGIN",label:a.Model.GID}),b.info("LOGIN User ",a.Model.Name)}catch(g){throw b.error(g),g}}}}])}(),function(){"use strict";var a=angular.module("es.Services.Web");a.factory("esStackTrace",function(){return{print:printStackTrace}}),a.provider("$log",function(){function a(){return log4javascript.getLogger("esLogger")}function b(a){d(new log4javascript.BrowserConsoleAppender);var b=angular.isDefined(a)&&a;b&&d(new log4javascript.PopUpAppender)}function c(a,b){if(f){i&&a&&a.connectionModel&&(i.setCustomField("userId",a.connectionModel.UserID),i.setCustomField("branchId",a.connectionModel.BranchID),i.setCustomField("langId",a.connectionModel.LangID));var c=f.getHeaders();if(c){var d,e=-1;for(d=0;d<c.length;d++)if("Authorization"==c[d].name){e=d;break}-1!=e&&c.splice(e,1)}b&&""!=b&&f.addHeader("Authorization",b)}}function d(a){return-1==e.indexOf(a)?(e.push(a),!0):!1}var e=[],f=null,g=null,h=log4javascript.Level.ALL,i=null;return{setLevel:function(a){h=a,g&&g.setLevel(h)},getLevel:function(){return h},getCurrentLevel:function(){return g?g.getEffectiveLevel():log4javascript.Level.OFF},addAppender:d,addDefaultAppenders:b,addESWebApiAppender:function(a,b){var c=a+"api/rpc/registerException/";return f=new log4javascript.AjaxAppender(c,!1),f.setSendAllOnUnload(!0),i=new log4javascript.JsonLayout,i.setCustomField("subscriptionId",b),f.setLayout(i),f.setWaitForResponse(!0),f.setBatchSize(100),f.setTimed(!0),f.setTimerInterval(6e4),f.addHeader("Content-Type","application/json"),f.setRequestSuccessCallback(function(a){console.log("ES Logger, BATCH of logs upoloaded",a.responseURL,a.status)}),f.setFailCallback(function(a){console.error("Failed to POST Logs to the server",a)}),d(f)},$get:["esMessaging",function(d){try{g=a(),g.setLevel(h),0==e.length&&b();var i=0;for(i=0;i<e.length;i++)g.addAppender(e[i]);return d.subscribe("AUTH_CHANGED",function(a,b){c(a,b)}),g.sendAll=function(){try{f&&f.sendAll()}catch(a){}},console.info("ES Logger started"),g}catch(j){return console.log("Error in starting entersoft logger",j),$log}}]}}),a.provider("$exceptionHandler",function(){var a={pushToServer:!1,logServer:""};return{getSettings:function(){return a},setPushToServer:function(b){a.pushToServer=b},setLogServer:function(b){a.logServer=b},$get:["$log","$window","esStackTrace","$injector",function(b,c,d,e){function f(f,g){var h,i,j;try{h=f.toString(),i=d.print({e:f}),j={errorUrl:c.location.href,errorMessage:h,stackTrace:i,cause:g||""},b.error(JSON.stringify(j,null,"	"))}catch(k){console.log(arguments)}if(a.pushToServer)try{var l=e.get("esWebApi");l.registerException(j,a.logServer)}catch(k){b.warn("ES Error in registerException on store "+a.logServer),b.error(k)}}return f}]}})}(),function(){"use strict";function ESParamVal(a,b,c){this.paramCode=a,this.paramValue=b,this.enumList=c}function ESNumericParamVal(a,b){ESParamVal.call(this,a,b)}function ESStringParamVal(a,b){ESParamVal.call(this,a,b)}function ESDateParamVal(a,b){b||(b={dRange:"ESDateRange(SpecificDate, #9999/01/01#, SpecificDate, #1753/01/01#)",fromD:null,toD:null}),ESParamVal.call(this,a,b)}function ESParamValues(a){this.setParamValues(a)}function ESMasterDetailGridRelation(a,b,c,d){this.relationID=a,this.detailDataSource=b,this.detailParams=c,this.detailParamCode=d||"ISUDGID"}function ESRequeryDetailGrids(){this.registeredRelations=[]}var esWEBUI=angular.module("es.Web.UI",["ngAnimate","ui.bootstrap"]);esWEBUI.run(["esMessaging",function(a){a.subscribe("AUTH_CHANGED",function(a,b){kendo&&(a&&a.connectionModel&&a.connectionModel.LangID?kendo.culture(a.connectionModel.LangID):kendo.culture("el-GR"))})}]);var dateRangeResolve=function(a){if(!a||!a.dRange)return"";var b=new Date,c=_.findWhere(esDateRangeOptions,{dValue:a.dRange});if(!c)return"";var d="el-GR",e=angular.element(document.querySelector("[ng-app]")).injector(),f=e.get("esGlobals");if(f){var g=f.getClientSession();g&&g.connectionModel&&g.connectionModel.LangID&&(d=g.connectionModel.LangID)}switch(c.dType){case 0:if(!angular.isDate(a.fromD)&&!angular.isDate(a.toD))return"";var h="";angular.isDate(a.fromD)&&(h=a.fromD.toLocaleDateString(d)),h+=" - ";var i="";return angular.isDate(a.toD)&&(i=a.toD.toLocaleDateString(d)),h+=i;case 1:return angular.isDate(a.fromD)?a.fromD.toLocaleDateString(d):"";case 2:return"";case 3:return b.toLocaleDateString(d);case 4:return"-> "+b.toLocaleDateString(d);case 5:return b.toLocaleDateString(d)+" ->";case 6:return b.setDate(b.getDate()-1),b.toLocaleDateString(d);case 7:return b.setDate(b.getDate()-1),b.toLocaleDateString(d)+" ->";case 8:return b.setDate(b.getDate()+1),b.toLocaleDateString(d);case 9:return b.setDate(b.getDate()+1),b.toLocaleDateString(d)+" ->";case 10:var j=b.getDay(),k=0==j?6:j-1,l=new Date(b),g=new Date(b);return l.setDate(b.getDate()-k),g.setDate(l.getDate()+6),l.toLocaleDateString(d)+" - "+g.toLocaleDateString(d);case 11:b.setDate(b.getDate()-7);var j=b.getDay(),k=0==j?6:j-1,l=new Date(b),g=new Date(b);return l.setDate(b.getDate()-k),g.setDate(l.getDate()+6),l.toLocaleDateString(d)+" - "+g.toLocaleDateString(d);case 12:b.setDate(b.getDate()+7);var j=b.getDay(),k=0==j?6:j-1,l=new Date(b),g=new Date(b);return l.setDate(b.getDate()-k),g.setDate(l.getDate()+6),l.toLocaleDateString(d)+" - "+g.toLocaleDateString(d);case 13:b.setDate(1);var l=new Date(b.getFullYear(),b.getMonth()+1,0);return b.toLocaleDateString(d)+" - "+l.toLocaleDateString(d);case 14:return b.setDate(1),b.toLocaleDateString(d)+" ->";case 15:var l=new Date(b.getFullYear(),b.getMonth()+1,0);return"-> "+l.toLocaleDateString(d);case 16:var l=new Date(b.getFullYear(),b.getMonth()-1,1),g=new Date(b.getFullYear(),b.getMonth(),0);return l.toLocaleDateString(d)+" - "+g.toLocaleDateString(d);case 17:var l=new Date(b.getFullYear(),b.getMonth()-1,1);return l.toLocaleDateString(d)+" ->";case 18:var l=new Date(b.getFullYear(),b.getMonth(),0);return"-> "+l.toLocaleDateString(d);case 19:var m=b.getMonth(),n=m%3,l=new Date(b.getFullYear(),m-n,1),g=new Date(b.getFullYear(),m+(3-n),0);return l.toLocaleDateString(d)+" -> "+g.toLocaleDateString(d);case 20:var m=b.getMonth(),n=m%3,g=new Date(b.getFullYear(),m-n,0),l=new Date(b.getFullYear(),g.getMonth()-2,1);return l.toLocaleDateString(d)+" -> "+g.toLocaleDateString(d);case 21:var l=new Date(b.getFullYear(),m>=6?6:0,1),g=new Date(b.getFullYear(),m>=6?11:5,m>=6?31:30);return l.toLocaleDateString(d)+" -> "+g.toLocaleDateString(d);case 22:var l,g,o=b.getFullYear();return m>=6?(l=new Date(o,0,1),g=new Date(o,5,30)):(l=new Date(o-1,6,1),g=new Date(o-1,11,31)),l.toLocaleDateString(d)+" -> "+g.toLocaleDateString(d);case 23:var o=b.getFullYear(),l=new Date(o,0,1),g=new Date(o,11,31);return l.toLocaleDateString(d)+" -> "+g.toLocaleDateString(d);case 24:var o=b.getFullYear()-1,l=new Date(o,0,1),g=new Date(o,11,31);return l.toLocaleDateString(d)+" -> "+g.toLocaleDateString(d);default:return c.title}},esComplexParamFunctionOptions=[{caption:"=",value:"EQ"},{caption:"<>",value:"NE"},{caption:"<",value:"LT"},{caption:"<=",value:"LE"},{caption:">",value:"GT"},{caption:">=",value:"GE"},{caption:"[]",value:"RANGE"},{caption:"Κενό",value:"NULL"},{caption:"Μη κενό",value:"NOTNULL"}],dDateRangeClass={6:[0,1,2,3,6,8,10,11,12,13,16,19,20,21,22,23,24],20:[0,1,25,26,27,28,29,30]},esDateRangeOptions=[{dValue:"0",dType:0,title:"Specific Date Range"},{dValue:"1",dType:1,title:"Specific Date"},{dValue:"ESDateRange(SpecificDate, #9999/01/01#, SpecificDate, #1753/01/01#)",
dType:2,title:"Anything"},{dValue:"ESDateRange(Day)",dType:3,title:"Today"},{dValue:"ESDateRange(SpecificDate, #1753/01/01#, Day, 0)",dType:4,title:"Up Today"},{dValue:"ESDateRange(Day, 0, SpecificDate, #9999/01/01#)",dType:5,title:"Starting from Today"},{dValue:"ESDateRange(Day, -1)",dType:6,title:"Yesterday"},{dValue:"ESDateRange(SpecificDate, #1753/01/01#, Day, -1)",dType:7,title:"Up To Yesterday"},{dValue:"ESDateRange(Day, 1)",dType:8,title:"Tomorrow"},{dValue:"ESDateRange(Day, 1, SpecificDate, #9999/01/01#)",dType:9,title:"Starting from Tomorrow"},{dValue:"ESDateRange(Week)",dType:10,title:"Current week"},{dValue:"ESDateRange(Week, -1)",dType:11,title:"Previous week"},{dValue:"ESDateRange(Week, 1)",dType:12,title:"Next week"},{dValue:"ESDateRange(Month)",dType:13,title:"Current month"},{dValue:"ESDateRange(Month, 0, SpecificDate, #9999/01/01#)",dType:14,title:"Since 1st of month"},{dValue:"ESDateRange(SpecificDate, #1753/01/01#, Month, 0)",dType:15,title:"Up to end of month"},{dValue:"ESDateRange(Month, -1)",dType:16,title:"Last month"},{dValue:"ESDateRange(Month, -1, SpecificDate, #9999/01/01#)",dType:17,title:"Since 1st of last month"},{dValue:"ESDateRange(SpecificDate, #1753/01/01#, Month, -1)",dType:18,title:"Up to end of last month"},{dValue:"ESDateRange(Quarter)",dType:19,title:"Current quarter"},{dValue:"ESDateRange(Quarter, -1)",dType:20,title:"Last quarter"},{dValue:"ESDateRange(SixMonth)",dType:21,title:"This HY"},{dValue:"ESDateRange(SixMonth, -1)",dType:22,title:"Last HY"},{dValue:"ESDateRange(Year)",dType:23,title:"Current Year"},{dValue:"ESDateRange(Year, -1)",dType:24,title:"Last Year"},{dValue:"ESDateRange(FiscalPeriod, 0)",dType:25,title:"Current Fiscal Period"},{dValue:"ESDateRange(FiscalYear, 0, Day, 0)",dType:26,title:"Since start of FY up today"},{dValue:"ESDateRange(FiscalYear, 0, FiscalPeriod, 0)",dType:27,title:"Since start of FY up to end of Fiscal Period"},{dValue:"ESDateRange(FiscalPeriod, -1)",dType:28,title:"Last Fiscal Period"},{dValue:"ESDateRange(FiscalPeriod, -1, Day, 0)",dType:29,title:"Since start of last Fiscal Period up today"},{dValue:"ESDateRange(FiscalYear, 0, FiscalPeriod, -1)",dType:30,title:"Since start of FY up to last Fiscal Period"}];ESParamVal.prototype.getExecuteVal=function(){return this.paramValue},ESParamVal.prototype.pValue=function(a){return arguments&&0!=arguments.length?this.paramValue===arguments[0]?!1:(this.paramValue=arguments[0],!0):this.paramValue},ESParamVal.prototype.strVal=function(){var a=this.enumList;if(!a||0==a.length)return this.paramValue?this.paramValue.toString():"";if(!this.paramValue)return"";var b;b=angular.isArray(this.paramValue)?this.paramValue:[this.paramValue];var c=_.reduce(b,function(b,c){var d=_.findWhere(a,{value:c});return b+(d?d.text:c.toString())+" + "},"");return c.substring(0,c.lastIndexOf(" + "))},ESNumericParamVal.prototype=Object.create(ESParamVal.prototype),ESNumericParamVal.prototype.strVal=function(){var a=0;a=a.toString();var b=this.paramValue.value?this.paramValue.value.toString():a,c=this.paramValue.valueTo?this.paramValue.valueTo.toString():a;switch(this.paramValue.oper){case"RANGE":return"ΑΠΟ "+b+" ΕΩΣ "+c;case"NULL":return"KENO";case"NOTNULL":return"MH KENO";default:return this.paramValue.oper.toString()+" "+b}},ESNumericParamVal.prototype.getExecuteVal=function(){switch(this.paramValue.value=this.paramValue.value||0,this.paramValue.valueTo=this.paramValue.valueTo||0,this.paramValue.oper){case"RANGE":return"ESNumeric("+this.paramValue.oper+", '"+this.paramValue.value+"', '"+this.paramValue.valueTo+"')";case"NULL":case"NOTNULL":return"ESNumeric("+this.paramValue.oper+", '0')";default:return"ESNumeric("+this.paramValue.oper+", '"+this.paramValue.value+"')"}},ESStringParamVal.prototype=Object.create(ESParamVal.prototype),ESStringParamVal.prototype.strVal=function(){var a=this.paramValue.value?this.paramValue.value.toString():"",b=this.paramValue.valueTo?this.paramValue.valueTo.toString():"";switch(this.paramValue.oper){case"RANGE":return"ΑΠΟ "+a+" ΕΩΣ "+b;case"NULL":return"KENO";case"NOTNULL":return"MH KENO";default:return this.paramValue.oper.toString()+" "+a}},ESStringParamVal.prototype.getExecuteVal=function(){switch(this.paramValue.oper){case"EQ":return this.paramValue.value;case"RANGE":return"ESString("+this.paramValue.oper+", '"+this.paramValue.value+"', '"+this.paramValue.valueTo+"')";case"NULL":case"NOTNULL":return"ESString("+this.paramValue.oper+", '')";default:return"ESString("+this.paramValue.oper+", '"+this.paramValue.value+"')"}},ESDateParamVal.prototype=Object.create(ESParamVal.prototype),ESDateParamVal.prototype.strVal=function(){return dateRangeResolve(this.paramValue)},ESDateParamVal.prototype.getExecuteVal=function(){var a=this.paramValue.dRange;if("0"==a||"1"==a){var b="#1753/01/01#",c="#9999/01/01#",d=!0,e=moment(this.paramValue.fromD);e.isValid()&&(d=!1,b=e.format("YYYY/MM/DD"));var f=moment(this.paramValue.toD);return f.isValid()&&(d=!1,c=f.format("YYYY/MM/DD")),"0"==a||d?"ESDateRange(SpecificDate, #"+b+"#, SpecificDate, #"+c+"#)":"ESDateRange(SpecificDate, #"+b+"#)"}return this.paramValue.dRange},ESParamValues.prototype.merge=function(a){var b=this;if(a)for(var c in a){if(!a[c]||!a[c]instanceof ESParamVal)throw new Error("Invalid paramter type in merge function in paramvalues");b.hasOwnProperty(c)&&b[c]instanceof ESParamVal?b[c].enumList=a[c].enumList:b[c]=a[c]}return this},ESParamValues.prototype.setParamValues=function(a){var b=this;for(var c in b)b.hasOwnProperty(c)&&delete b[c];a&&_.isArray(a)&&0!=a.length&&a.forEach(function(a,c,d){b[a.paramCode]=a})},ESParamValues.prototype.getExecuteVals=function(){var a=this,b={};for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];(d.paramValue||angular.isNumber(d.paramValue)&&0==d.paramValue)&&(b[d.paramCode]=d.getExecuteVal())}return b},ESRequeryDetailGrids.prototype.addDetailRelation=function(a){if(!(a&&a instanceof ESMasterDetailGridRelation))throw"relInfo parameter is null or is not of type ESMasterDetailGridRelation";if(!a.relationID)throw"The parameter does not contain relationID or is null/emptystring/undefined";var b=a.relationID.toLowerCase(),c=_.findIndex(this.registeredRelations,function(a){return a.relationID.toLowerCase()==b});return 0>c?this.registeredRelations.push(a):this.registeredRelations[c]=a,this},ESRequeryDetailGrids.prototype.getDetailRelation=function(a){if(!relationID)throw"relationID is null/emptystring/undefined";var b=relationID.toLowerCase(),c=_.findIndex(this.registeredRelations,function(a){return a.toLowerCase()==b});return 0>c?null:this.registeredRelations[c]},ESRequeryDetailGrids.prototype.removeDetailRelation=function(a){if(!relationID)throw"relationID is null/emptystring/undefined";var b=relationID.toLowerCase(),c=_.findIndex(this.registeredRelations,function(a){return a.toLowerCase()==b});return 0>c?!1:(this.registeredRelations=this.registeredRelations.splice(c,1),!0)},esWEBUI.filter("esTrustHtml",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),esWEBUI.filter("esParamTypeMapper",function(){var a=function(a){if(!a)return"";var b=a.parameterType.toLowerCase();if(0==b.indexOf("entersoft.framework.platform.esdaterange, queryprocess"))return"esParamDateRange";if(0==b.indexOf("entersoft.framework.platform.esnumeric"))return"esParamAdvancedNumeric";if(0==b.indexOf("entersoft.framework.platform.esstring, queryprocess"))return"esParamAdvancedString";if(0==b.indexOf("system.string, mscorlib"))switch(a.controlType){case 1:return"esParamNumeric";case 2:return"esParamNumeric"}return a.enumList&&a.enumList.length>1?a.multiValued||a.enumOptionAll?"esParamMultiEnum":"esParamEnum":a.invSelectedMasterTable&&"Z"==a.invSelectedMasterTable[4]?a.multiValued?"esParamMultiZoom":"esParamZoom":"esParamText"};return a}).directive("esGrid",["$log","esWebApi","esMessaging","esUIHelper",function(a,b,c,d){return{restrict:"AE",scope:{esGroupId:"=",esFilterId:"=",esExecuteParams:"=",esGridOptions:"=",esSrvPaging:"="},templateUrl:function(b,c){return a.info("Parameter element = ",b," Parameter attrs = ",c),"src/partials/esGrid.html"},link:function(c,e,f){if(c.esGridRun=function(){c.esGridCtrl&&c.esGridCtrl.dataSource.read()},c.downloadBlob=function(d){b.fetchES00DocumentBlobDataByGID(d).then(function(b){var d=b.data,e=b.headers()["content-type"];a.info("File "+c.pAsset+" ===> "+e);var f=new Blob([d],{type:e}),g=URL.createObjectURL(f);window.open(g)})["catch"](function(b){a.error("2nd error = "+JSON.stringify(b))})},c.esGridPrint=function(){if(c.esGridCtrl){var a=c.esGridCtrl.element,b="",d=window.open("","","width=800, height=500"),e=d.document.open(),f='<!DOCTYPE html><html><head><meta charset="utf-8" /><title>Kendo UI Grid</title><link href="http://kendo.cdn.telerik.com/'+kendo.version+'/styles/kendo.common.min.css" rel="stylesheet" /> <style>html { font: 11pt sans-serif; }.k-grid { border-top-width: 0; }.k-grid, .k-grid-content { height: auto !important; }.k-grid-content { overflow: visible !important; }.k-grid .k-grid-header th { border-top: 1px solid; }.k-grid-toolbar, .k-grid-pager > .k-link { display: none; }</style></head><body>',g="</body></html>",h=a.children(".k-grid-header");if(h[0]){var i=h.find("thead").clone().addClass("k-grid-header");b=a.clone().children(".k-grid-header").remove().end().children(".k-grid-content").find("table").first().children("tbody").before(i).end().end().end().end()[0].outerHTML}else b=a.clone()[0].outerHTML;e.write(f+b+g),e.close(),d.print()}},!c.esGridOptions&&!f.esGridOptions){if(!c.esGroupId||!c.esFilterId)throw"esGridOptions NOT defined. In order to dynamically get the options you must set GroupID and FilterID for esgrid to work";b.fetchPublicQueryInfo(c.esGroupId,c.esFilterId).then(function(a){var b=a.data,e=d.winGridInfoToESGridInfo(c.esGroupId,c.esFilterId,b);c.esGridOptions=d.esGridInfoToKInfo(c.esGroupId,c.esFilterId,c.esExecuteParams,e,c.esSrvPaging)})}}}}]).directive("es00DocumentsDetail",["$log","$uibModal","esWebApi","esUIHelper",function(a,b,c,d){return{restrict:"AE",scope:{esDocumentGridOptions:"=",esMasterRowField:"="},template:"<div ng-include src=\"'src/partials/es00DocumentsDetail.html'\"></div>",link:function(b,e,f){b.downloadBlob=function(a){alert(a)},b.esMasterRowField||f.esMasterRowField||(b.esMasterRowField="GID",a.warn("esMasterRowField for es00DocumentsDetail directive NOT specified. Assuming GID")),a.info("es00DocumentsDetail directive");var g=function(){var a="ESGOCompany",e="ES00DocumentsDetails",f={serverGrouping:!1,serverSorting:!1,serverFiltering:!1,serverPaging:!1,pageSize:20,transport:{read:function(a){c.fetchES00DocumentsByEntityGID(b.$parent.dataItem[b.esMasterRowField]).then(function(b){a.success(b)},function(b){a.error(b)})}},schema:{data:"data",total:"data.length"}},g=new kendo.data.DataSource(f);c.fetchPublicQueryInfo(a,e,!0).then(function(c){var f=c.data,h=d.winGridInfoToESGridInfo(a,e,f);c=d.esGridInfoToKInfo(a,e,{},h,!1),c.autoBind=!0,c.toolbar=null,c.groupable=!1,c.dataSource=g,c.columns.push({template:'<button class="btn btn-primary" ng-click="downloadBlob(dataItem.GID)">Download</button>'}),b.esDocumentGridOptions=angular.extend(c,b.esDocumentGridOptions)})};g()}}}]).directive("esParam",["$log","$uibModal","esWebApi","esUIHelper",function(a,b,c,d){return{restrict:"AE",scope:{esParamDef:"=",esParamVal:"=",esType:"="},template:"<div ng-include src=\"'src/partials/'+esType+'.html'\"></div>",link:function(a,b,e){if(!a.esParamDef)throw"You must set a param";a.esWebUIHelper=d,a.esWebApiService=c,a.esParamDef.invSelectedMasterTable&&(a.esParamLookupDS=d.getZoomDataSource(a.esParamDef.invSelectedMasterTable)),(6==a.esParamDef.controlType||20==a.esParamDef.controlType)&&(a.dateRangeOptions=d.getesDateRangeOptions(a.esParamDef.controlType))}}}]).directive("esWebPq",["$log","esWebApi","esUIHelper","esMessaging",function(a,b,c,d){return{restrict:"AE",scope:{esGroupId:"=",esFilterId:"=",esGridOptions:"=",esParamsValues:"=",esSrvPaging:"=",esShowTopPagination:"="},templateUrl:function(b,c){return a.info("Parameter element = ",b," Parameter attrs = ",c),"src/partials/esWebPQ.html"},link:function(a,d,e){if(!a.esGroupId||!a.esFilterId)throw"You must set the pair es-group-id and es-filter-id attrs";a.executePQ=function(){a.esGridOptions.dataSource.read()},b.fetchPublicQueryInfo(a.esGroupId,a.esFilterId).then(function(b){var d=c.winGridInfoToESGridInfo(a.esGroupId,a.esFilterId,b.data);a.esParamsValues&&a.esParamsValues instanceof ESParamValues?a.esParamsValues.merge(d.defaultValues):a.esParamsValues=d.defaultValues,a.esParamsDef=d.params;var e=c.esGridInfoToKInfo(a.esGroupId,a.esFilterId,a.esParamsValues,d,a.esSrvPaging);a.esGridOptions=angular.extend(e,a.esGridOptions)})}}}]).directive("esParamsPanel",["$log","esWebApi","esUIHelper",function(a,b,c){return{restrict:"AE",scope:{esParamsDef:"=",esPqInfo:"=",esParamsValues:"=",esGroupId:"=",esFilterId:"="},templateUrl:function(b,c){return a.info("Parameter element = ",b," Parameter attrs = ",c),"src/partials/esParams.html"},link:function(a,d,e){if(!(e.esParamsDef||e.esPqInfo||a.esGroupId&&a.esFilterId))throw"You must set either the es-params-def or ea-pq-info or the pair es-group-id and es-filter-id attrs";e.esParamsDef||(e.esPqInfo?a.esParamDef=esPqInfo.params:b.fetchPublicQueryInfo(a.esGroupId,a.esFilterId)["function"](function(b){var d=c.winGridInfoToESGridInfo(a.esGroupId,a.esFilterId,b.data);a.esParamsValues&&a.esParamsValues instanceof ESParamValues?a.esParamsValues.merge(d.defaultValues):a.esParamsValues=d.defaultValues,a.esParamsDef=d.params}))}}}]),esWEBUI.factory("esUIHelper",["$log","$timeout","esMessaging","esWebApi",function($log,$timeout,esMessaging,esWebApiService){function esColToKCol(a){var b={field:a.field,title:a.title,width:a.width,attributes:a.attributes,columnSet:a.columnSet,values:a.enumValues,dataType:a.dataType,hidden:!a.visible,headerAttributes:{"class":"es-table-header-cell"},template:void 0};switch(a.dataType){case"int32":case"byte":"8"==a.editType&&(b.template=kendo.format('<div align="center"><input type="checkbox" #={0} ? "checked=checked" : "" # disabled="disabled" ></input></div>',a.field));break;case"byte[]":"0"==a.editType&&(b.template="<img src='#:kendo.format('data:image/jpg;base64,{0}', "+a.field+")#'/>");break;case"string":var c="";-1!=a.field.toLowerCase().indexOf("email")?c="mailto:":(-1!=a.field.toLowerCase().indexOf("tele")||-1!=a.field.toLowerCase().indexOf("mobile"))&&(c="tel:"),c&&(b.template=kendo.format("<a href='{1}#={0}||''#'>#={0}||''#</a>",a.field,c));break;case"datetime":var d=a.formatString||"d";b.format="{0:"+d+"}";break;default:a.formatString&&""!=a.formatString&&(b.format="{0:"+a.formatString+"}")}return b}function handleChangeGridRow(a){var b=this.select(),c=!1,d=void 0;if(b&&1==b.length&&(d=this.dataItem(b[0]).GID,c=!0),this.options.masterDetailRelations){if(!(this.options.masterDetailRelations instanceof ESRequeryDetailGrids))throw"masterDetailRelations should be of type ESRequeryDetailGrids";_.each(this.options.masterDetailRelations.registeredRelations,function(a){a instanceof ESMasterDetailGridRelation&&$timeout(function(){var b=a.detailParams(),c=a.detailDataSource();c&&b&&b[a.detailParamCode]&&b[a.detailParamCode].pValue(d)&&c.read()})})}esMessaging.publish("GRID_ROW_CHANGE",a,c?b[0]:null,d)}function prepareStdZoom(a,b){var c={transport:{read:function(c){$log.info("FETCHing ZOOM data for [",a,"] with options ",JSON.stringify(c));var d={};esWebApiService.fetchStdZoom(a,d,b).then(function(b){var d=b.data;-1==d.Count&&(d.Count=d.Rows?d.Rows.length:0),c.success(d),$log.info("FETCHed ZOOM data for [",a,"] with options ",JSON.stringify(c))},function(a){c.error(a)})}},schema:{data:"Rows",total:"Count"}};return new kendo.data.DataSource(c)}function prepareWebScroller(a,b,c){var d=angular.isFunction(b)?b():b,e={transport:{read:function(a){$log.info("FETCHing PQ with PQParams ",JSON.stringify(d)," and gridoptions ",JSON.stringify(a));var b={};a.data&&a.data.page&&a.data.pageSize&&(b.WithCount=!0,b.Page=a.data.page,b.PageSize=a.data.pageSize);var c=d.Params;c instanceof ESParamValues&&(c=c.getExecuteVals()),esWebApiService.fetchPublicQuery(d.GroupID,d.FilterID,b,c).success(function(b){angular.isDefined(b.Rows)||(b.Rows=[],b.Count=0),angular.isDefined(b.Count)||(b.Count=-1),a.success(b),$log.info("FETCHed PQ with PQParams ",JSON.stringify(c)," and gridoptions ",JSON.stringify(a))}).error(function(b){$log.error("Error in DataSource ",b),a.error(b)})}},requestStart:function(a){$log.info("request started ",a)},schema:{data:"Rows",total:"Count"}};return d&&d.SchemaColumns&&d.SchemaColumns.length&&(e.schema.parse=function(a){return _.each(a.Rows,function(a){_.each(d.SchemaColumns,function(b){var c=b.field;a[c]&&"string"==typeof a[c]&&(a[c]=kendo.parseDate(a[c]))})}),a}),c&&angular.extend(e,c),a&&"pivot"===a?new kendo.data.PivotDataSource(e):new kendo.data.DataSource(e)}function esGridInfoToKInfo(a,b,c,d,e){var f={serverGrouping:!1,serverSorting:!1,serverFiltering:!1,serverPaging:angular.isUndefined(e)||null==e?!0:!!e,pageSize:20},g={pageable:{refresh:!0,pageSizes:[20,50,100,"All"]},autoBind:!1,sortable:!f.serverPaging,scrollable:!0,selectable:"row",allowCopy:!0,resizable:!0,reorderable:!0,navigatable:!0,noRecords:{template:'<h3><span class="label label-info">Sorry, No Records found</span></h3>'},filterable:!f.serverPaging,groupable:!f.serverPaging,toolbar:[{name:"run",text:"Run",template:"<a class='k-button' ng-click=\"esGridRun()\">Run</a>"},"pdf","excel"],pdf:{allPages:!0,fileName:a+"-"+b+".pdf"},excel:{allPages:!0,fileName:a+"-"+b+".xlsx",filterable:!0}};return g.columns=d.columns,g.selectedMasterField=d.selectedMasterField,g.selectedMasterTable=d.selectedMasterTable,g.columnMenu=!0,g.dataSource=prepareWebScroller(null,function(){return{GroupID:a,FilterID:b,Params:c,SchemaColumns:_.where(g.columns,{dataType:"datetime"})}},f),g.change=handleChangeGridRow,g.dataBound=handleChangeGridRow,g}function winColToESCol(a,b,c,d){var e={AA:void 0,field:void 0,title:void 0,width:void 0,visible:void 0,attributes:void 0,enumValues:void 0,formatString:void 0,odsTag:void 0,dataType:void 0,editType:void 0,columnSet:void 0};e.AA=parseInt(d.AA),e.field=d.ColName,e.title=d.Caption,e.odsTag=d.ODSTag,e.columnSet=parseInt(d.ColumnSet),e.dataType=d.DataTypeName?d.DataTypeName.toLowerCase():void 0,e.editType=d.EditType,e.formatString=d.FormatString,e.visible="true"==d.Visible;var f=e.dataType;switch(e.dataType){case"byte":8==e.editType&&(f="boolean-checkbox")}if(e.attributes={"class":"es-grid-cell-"+f},"3"==d.TextAlignment&&(e.attributes.style="text-align: right;"),"5"==d.EditType){var g=_.sortBy(_.filter(c.ValueList,function(a){var c=a.ColName==d.ColName;return c=c&&"undefined"!=typeof a.Value,c=c&&a.fFilterID.toLowerCase()==b}),function(a){return isNaN(a.Value)?null:parseInt(a.Value)}),h=_.map(g,function(a){return{text:a.Caption,value:isNaN(a.Value)?null:parseInt(a.Value)}});h&&h.length&&(e.enumValues=h)}return e}function dateEval(pInfo,expr){function isActualDate(a){return a&&"1753/01/01"!=a&&"9999/01/01"!=a}var SpecificDate="SpecificDate",Month="Month",SixMonth="SixMonth",Week="Week",Year="Year",Quarter="Quarter",Day="Day",dVal=eval(expr.replace(/#/g,'"')),esdate=new ESDateParamVal(pInfo.id),mD=moment(dVal,"YYYY/MM/DD");return dVal.fromType||dVal.toType||dVal.fromD||dVal.toD||!mD.isValid()?dVal.fromType==SpecificDate&&isActualDate(dVal.fromD)&&dVal.toType==SpecificDate&&isActualDate(dVal.toD)?(esdate.paramValue.dRange="0",esdate.paramValue.fromD=new Date(dVal.fromD),esdate.paramValue.toD=new Date(dVal.toD),esdate):dVal.fromType==SpecificDate&&isActualDate(dVal.fromD)?(esdate.paramValue.dRange="1",esdate.paramValue.fromD=new Date(dVal.fromD),esdate):(esdate.paramValue.dRange=expr,esdate):(esdate.paramValue.dRange="1",esdate.paramValue.fromD=mD.toDate(),esdate)}function esEval(pInfo,expr){var EQ={oper:"EQ",paramID:pInfo.id},GE={oper:"GE",paramID:pInfo.id},GT={oper:"GT",paramID:pInfo.id},LE={oper:"LE",paramID:pInfo.id},LT={oper:"LT",paramID:pInfo.id},NE={oper:"NE",paramID:pInfo.id},RANGE={oper:"RANGE",paramID:pInfo.id},NULL={oper:"NULL",paramID:pInfo.id},NOTNULL={oper:"NOTNULL",paramID:pInfo.id};return eval(expr)}function ESNumeric(a,b,c){var d={value:isNaN(b)?null:parseInt(b),valueTo:isNaN(c)?null:parseInt(c),oper:a.oper||"EQ"};return new ESNumericParamVal(a.paramID,d)}function ESString(a,b,c){var d={value:b,valueTo:c,oper:a.oper||"EQ"};return new ESStringParamVal(a.paramID,d)}function ESDateRange(a,b,c,d){return{fromType:a,fromD:b,toType:c,toD:d}}function getEsParamVal(a,b){var c=a.parameterType.toLowerCase();if(0==c.indexOf("entersoft.framework.platform.esnumeric"))return b&&0!=b.length?esEval(a,b[0].Value):new ESNumericParamVal(a.id,{oper:"EQ",value:0});if(0==c.indexOf("entersoft.framework.platform.esdaterange, queryprocess"))return b&&0!=b.length?dateEval(a,b[0].Value):new ESDateParamVal(a.id,6==a.controlType?null:{dRange:"ESDateRange(FiscalPeriod, 0)",fromD:null,toD:null});if(0==c.indexOf("entersoft.framework.platform.esstring, queryprocess"))return b&&0!=b.length?esEval(a,b[0].Value):new ESStringParamVal(a.id,{oper:"EQ",value:null});if(!b||0==b.length)return new ESParamVal(a.id,null,a.enumList);var d=_.map(b,function(b){return processStrToken(a,b.Value)});return 1==d.length&&(d=d[0]),new ESParamVal(a.id,d,a.enumList)}function processStrToken(a,b){if(!a)return b;var c=a.parameterType.toLowerCase();return-1!=c.indexOf("system.byte")||-1!=c.indexOf("system.int")?parseInt(b):a.enumList&&a.enumList.length>1?parseInt(b):b}function ESParamInfo(){this.id=void 0,this.aa=void 0,this.caption=void 0,this.toolTip=void 0,this.controlType=void 0,this.parameterType=void 0,this.precision=void 0,this.multiValued=void 0,this.visible=void 0,this.required=void 0,this.oDSTag=void 0,this.formatStrng=void 0,this.tags=void 0,this.visibility=void 0,this.invSelectedMasterTable=void 0,this.invSelectedMasterField=void 0,this.invTableMappings=void 0,this.defaultValues=void 0,this.enumOptionAll=void 0,this.enumList=void 0}function ESParamsDefinitions(a,b){this.title=a,this.definitions=b,this.visibleDefinitions=function(){if(!this.definitions)return[];var a=this.definitions;return _.where(a,{visible:!0})}}function winParamInfoToesParamInfo(a,b){if(!a)return null;var c=new ESParamInfo;c.id=a.ID,c.aa=parseInt(a.AA),c.caption=a.Caption,c.toolTip=a.Tooltip,c.controlType=parseInt(a.ControlType),c.parameterType=a.ParameterType,c.precision=parseInt(a.Precision),c.multiValued="true"==a.MultiValued,c.visible="true"==a.Visible,c.required="true"==a.Required,c.oDSTag=a.ODSTag,c.tags=a.Tags,c.visibility=parseInt(a.Visibility),c.invSelectedMasterTable=a.InvSelectedMasterTable,c.invSelectedMasterField=a.InvSelectedMasterField,c.invTableMappings=a.InvTableMappings,c.enumOptionAll=a.EnumOptionAll;var d=_.sortBy(_.map(_.filter(b.EnumItem,function(a){return a.fParamID==c.id&&"undefined"!=typeof a.ID}),function(a){return{text:c.oDSTag?a.Caption.substring(a.Caption.indexOf(".")+1):a.Caption,value:isNaN(a.ID)?null:parseInt(a.ID)}}),"value");c.enumList=d.length?d:void 0;var e=b.DefaultValue;if(e&&angular.isArray(e)){var f=_.where(e,{fParamID:c.id});c.defaultValues=getEsParamVal(c,f)}else c.defaultValues=getEsParamVal(c,[]);return c}function winGridInfoToESGridInfo(a,b,c){if(!c||!c.LayoutColumn)return null;var d=b.toLowerCase(),e=_.filter(c.Filter,function(a){return a.ID.toLowerCase()==d});if(!e||1!=e.length)return null;var f={id:void 0,caption:void 0,rootTable:void 0,selectedMasterTable:void 0,selectedMasterField:void 0,columnSets:void 0,columns:void 0,params:void 0,defaultValues:void 0},g=_.map(_.filter(c.LayoutColumn,function(a){return a.fFilterID.toLowerCase()==d&&"Guid"!=a.DataTypeName}),function(b){return winColToESCol(a,d,c,b)}),h=_.sortBy(g,function(a){return parseInt(a.AA)}),i=_.map(h,function(a){return esColToKCol(a)});e=e[0],f.id=e.ID,f.caption=e.Caption,f.rootTable=e.RootTable,f.selectedMasterTable=e.SelectedMasterTable,f.selectedMasterField=e.SelectedMasterField,f.columnSets=_.sortBy(_.map(_.filter(c.LayoutColumnSet,function(a){return a.fFilterID.toLowerCase()==d}),function(a){return{aa:parseInt(a.Position),title:a.Caption,columns:void 0}}),"aa"),f.columns=i,f.columnSets&&f.columnSets.length>0?(_.each(f.columnSets,function(a){a.columns=_.where(i,{columnSet:a.aa}),i=_.difference(i,a.columns)}),f.columnSets=_.sortBy(_.filter(f.columnSets,function(a){return a.columns&&a.columns.length>0}),"aa"),i=f.columnSets.concat(i),f.columns=i):f.columns=i,f.params=new ESParamsDefinitions(f.caption,_.map(c.Param,function(a){return winParamInfoToesParamInfo(a,c)}));var j=_.map(f.params.definitions,function(a){return a.defaultValues});return f.defaultValues=new ESParamValues(j),f}return ESParamInfo.prototype.strVal=function(){return"Hello World esParaminfo"},ESParamsDefinitions.prototype.visibleDefinitions=function(){var a=this.definitions;return a?_.where(a,{visible:!0}):[]},ESParamsDefinitions.prototype.strVal=function(a){if(!a||!this.definitions||0==this.definitions.length)return"";var b=_.reduce(_.sortBy(_.where(this.definitions,{visible:!0}),"aa"),function(b,c){return b+"<h3>"+c.caption+": </h3>"+a[c.id].strVal()+"<br/>"},"");return b},{ESParamValues:ESParamValues,ESParamVal:ESParamVal,ESNumericParamVal:ESNumericParamVal,ESStringParamVal:ESStringParamVal,ESDateParamVal:ESDateParamVal,ESRequeryDetailGrids:ESRequeryDetailGrids,ESMasterDetailGridRelation:ESMasterDetailGridRelation,winGridInfoToESGridInfo:winGridInfoToESGridInfo,winColToESCol:winColToESCol,esColToKCol:esColToKCol,esGridInfoToKInfo:esGridInfoToKInfo,getZoomDataSource:prepareStdZoom,getPQDataSource:prepareWebScroller,getesDateRangeOptions:function(a){if(!a||!dDateRangeClass[a])return esDateRangeOptions;var b=dDateRangeClass[a];if(!_.isArray(b)||0==b.length)return esDateRangeOptions;var c,d=[];for(c=0;c<b.length;c++)d[c]=esDateRangeOptions[b[c]];return d},getesComplexParamFunctionOptions:function(){return esComplexParamFunctionOptions}}}])}();